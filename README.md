# HeavenFox Operation System
# 

**English** | [中文](./README_zh.md)

## Note
    HeavenFox OS aims to simplify the Linux kernel by refering to the kernel mechanism,
    which is convenient for the developers to research and apply, and the project follows
    the GPL license and is open source for life.

## Information
    author:     Yang Yujun
    created on: 2023.12.21
    e-mail:     <yujiantianhu@163.com>
    git:        git@github.com:yujiantianhu/HeavenFox.git

## Feature
    01) support multithreading (time slice, priority preemption, and delayed sleep);
    02) support initcall implicit initialization;
    03) support character device driver framework;
    04) support framebuffer driver framework;
    05) support IRQ virtual interrupt numbers mapping (GIC_SPI);
    06) support timer link list (timer_list);
    07) support SD Card (porting fatfs), and provide general APIs, such as file_open/file_close, ...;
    08) support Device Tree (support reading .dtb in SD Card, and parsing it to device_node and platform_device);
    09) support platform: bus - device - driver framework;
    10) provide APIs such as open/close/read/write, access hardware through "fd" and "file_operations";
    11) support flexible selection of source files to be complied through Makefile;
    12) support pinctrl, gpio (and gpio-irq), clock subsystem;
    13) support i2c bus framework: adapter - client - driver;
    14) support workqueue, mutex lock, spin lock and mailbox (inter-thread communication, e.g, ITC);
    15) support waitqueue, semaphore;
    16) support DTC compiler, dtb can be generated by "make dtbs";
    17) support virtual file system (kset, kobject and inode) and operations, such as virt_open/virt_close, ...;
    18) support touchscreen driver of "tsc2007", environment sensor driver "ap3216c", eeprom driver "at24c02";
    19) support cpu zynq7 (boot and running);
    20) support configure resources freely by "configs/mach/xxxx_defconfig', and generate auto.conf and autoconf.h
    
## Methods
    make:           build the whole project;
    make all:       the same as "make"
    make dtbs:      build device-tree only;
    make clean:     delete all the .o and .d;
    make distclean: delete the ./objects/* and .elf, .dis, .img and so on;
    make config:    generate auto.conf and autoconf.h, maybe you can input: make CONFIGS=xxxx_defconfig config
    make info:      get this project information;
    make libs:      build "lib/" only;
    make local:     build but not include dtbs and libs
    
    or using cmake:
    mkdir -p ./build
    cd ./build
    make distclean
    cmake -DCMAKE_BUILD_TYPE=debug ..
    make
    
    Image path: ./boot/image/HeavenFox.img
    Dtbs  path: ./boot/image/firmware.dtb
    
## Folder Instruction
    boot/:          containing device-tree, memory resources and OS image;
    configs/:       optional feature configurations (by setting macro definitions);
    build/:         for CMake (perhaps you can create it by "mkdir -p ./build";
    document/:      instuction documents;
    scripts/:       some tools for compiling or debugging, such as dtc, jlink scripts, ..., and Makefile.build;
    objects/:       when you build the project, the generated intermediate files will be stored here;
    
    arch/:          cpu architecture related files, contain chip-startup, vector table and register definitions for each cpu, ...;
    board/:         specific board related files, contain direct operations on board resources;
    common/:        the generic definitions and functions, which are applied to all files;
    drivers/:       the hardware drivers for each chip and board perephral;
    example/:       application instances;
    fs/:            file system related files
    include/:       headers for the whole project;
    init/:          global initialization, such as "main.c";
    kernel/:        for multi-thread features, containing scheduler, and generic threading methods;
    lib/:           the third-party libraries or code;
    platform/:      the generic abstract framework for system operations, provides methods to standardize programming specifications;

## Updating Record
### 2024.11.17
    author: Yang Yujun
    commit: 
        1) add third-party library "lvgl";
        2) adjust the compilation method of third-party libs (linked to main project with static libraries)

### 2024.11.09
    author: Yang Yujun
    commit: 
        1) fix the problem where the context can not be restored after thread was switched;
        2) support cpu xc7z010, including uart, hdmi, ...;
        3) support configure resources freely by "configs/mach/xxxx_defconfig', and generate auto.conf and autoconf.h;
        4) rename directory "rootfs" > "fs", provide general file system APIs (file_open/file_write/...);
        5) support block device and gendisk simply;
        6) add new directory "lib", the third-party libraries and projects will be put here;
        7) framebuffer can be allocated by "kmalloc", but the argument is GFP_DRAM instead of GFP_NORMAL;
        8) fatfs can be called by file_open, disk will be mounted to virtual file system "/media/FATFS_x";
        9) optimize top Makefile and Makefile.build's structure, fix the issue of duplicate compliation during make;
        10) change the path of image generation

### 2024.07.02
    author: Yang Yujun
    commit: support cpu "xc7z010" (initial SD Card, and copy dtb to DDR; then booting to "start_kernel")

### 2024.06.12
    author: Yang Yujun
    commit: 
        01) support kobject and kset, every device can be populated to virtual file system;
        02) add i2c client driver: ap3216c, at24c02;
        03) all implict initializations (platform_init, pattern_init, ...) move to drivers/base

### 2024.06.05
    author: Yang Yujun
    commit: 
        01) code maintenance, optimize LCD display code and i2c driver code of imx6ull;
        02) change the display content of "display-app" thread

### 2024.06.03
    author: Yang Yujun
    commit: support DTC compiler, dtb can be generated by "make dtbs"

### 2024.06.02
    author: Yang Yujun
    commit: 
        01) support semaphore, wait queue;
        02) standardize the naming of scheduler APIs;
        03) support multiple scheduling methods (configured by "CONFIG_PREEMPT", "CONFIG_SCHEDUL", ...)

### 2024.05.27
    author: Yang Yujun
    commit: standardize the naming of error code

### 2024.05.26
    author: Yang Yujun
    commit:
        01) add mailbox (inter-thread communication);
        02) optimize mutex lock and spin lock;
        03) add workqueue (for the low half interrupt);
        04) standardize the naming of variable types (such as kint32_t, structure, and so on)
        05) change project name to "HeavenFox"

### 2024.05.13
    author: Yang Yujun
    commit:
        01) add pinctrl device framework;
        02) add gpio device framework;
        03) add clock system framework;
        04) add i2c master, device and instance (tsc2007) driver;
        05) optimize irq framework

### 2024.04.18
    author: Yang Yujun
    commit: configure .gitignore, ignore vscode and object

### 2024.04.16:
    author: Yang Yujun
    commit: change project name to "gardens"

### 2024.04.15
    author: Yang Yujun
    commit: 
        01) fix the issue that the first thread scheduling register was overwritten;
        02) add display generic APIs
        03) optimize code

### 2024.04.13
    author: Yang Yujun
    commit: makefile optimization, supporting selective compilation of source files

### 2024.04.07
    author: Yang Yujun
    commit:
        01) support multithreading (time slice, priority preemption, and delayed sleep);
        02) support initcall implicit initialization;
        03) support character device driver framework;
        04) support framebuffer driver framework;
        05) support IRQ virtual interrupt numbers mapping (GIC_SPI);
        06) support timer link list (timer_list);
        07) support SD Card (porting fatfs);
        08) support Device Tree (support reading .dtb in SD Card, and parsing it to device_node and platform_device);
        09) support platform: bus - device - driver framework;
        10) provide APIs such as open/close/read/write, access hardware through “fd” and “file_operations”.

### 2023.12.21
    author: Yang Yujun
    commit: create README.md first
